<div class="experience-container">
  <header class="page-header">
    <h1>Experience</h1>
  </header>

  @if (loading()) {
    <div class="loading">Loading...</div>
  }

  @if (error()) {
    <div class="error">{{ error() }}</div>
  }

  @if (!loading() && !error()) {
    <div class="content-grid">
      <div class="map-column">
        <div class="map-container">
          <div id="experience-map" class="experience-map"></div>
        </div>
      </div>

      <div class="timeline-column">
        <h2 class="timeline-title">Recent Roles</h2>
        <div class="timeline">
          @for (exp of recentExperiences(); track exp.title + exp.company) {
            <div class="timeline-item" (click)="navigateToExperience(exp)">
              <div class="timeline-date">{{ formatDate(exp.start_date) }} - {{ exp.is_current ? 'Present' : formatDate(exp.end_date!) }}</div>
              <h3 class="timeline-title-text">{{ exp.title }}</h3>
              <div class="timeline-company">{{ exp.company }}</div>
              <div class="timeline-badge" [style.background-color]="getEmploymentColor(exp.employment_type)">{{ exp.employment_type }}</div>
            </div>
          }
        </div>
      </div>
    </div>

    @if (selectedExperience()) {
      <div class="popup-overlay" (click)="resetMap()">
        <div class="popup" (click)="$event.stopPropagation()">
          <button class="close" (click)="resetMap()">×</button>
          <button class="back-btn" (click)="resetMap()">← Back to Map</button>
          
          <h2>{{ selectedExperience()!.title }}</h2>
          <h3>{{ selectedExperience()!.company }}</h3>
                    <div class="employment-badge" [style.background-color]="getEmploymentTypeColor(selectedExperience()!.employment_type)">
            {{ selectedExperience()!.employment_type }}
          </div>
                    <p class="meta">
            {{ selectedExperience()!.location }} 
            {{ formatDate(selectedExperience()!.start_date) }} - 
            @if (selectedExperience()!.end_date) {
              {{ formatDate(selectedExperience()!.end_date!) }}
            } @else {
              Present
            }
          </p>
          
          @if (selectedExperience()!.technologies.length > 0) {
            <div class="tech">
              @for (tech of selectedExperience()!.technologies.slice(0, 3); track tech) {
                <span>{{ tech }}</span>
              }
            </div>
          }
        </div>
      </div>
    }
  }
</div>
